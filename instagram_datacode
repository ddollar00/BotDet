from datetime import datetime
from itertools import dropwhile, takewhile
import csv
import json
import instaloader
import pandas as pd
import csv
bot = instaloader.Instaloader()
users=["mk.raven"]
for username in users:
# Loading a profile from an Instagram handle
    with open("TestingIG_data.csv", mode = 'a', encoding='utf-8')as f:
        profile = instaloader.Profile.from_username(bot.context, username)
        posts = instaloader.Profile.from_username(bot.context, username).get_posts()
        SINCE = datetime(2022,9,3)
        UNTIL = datetime(2022,10,13)
       
        for post in takewhile(lambda p: p.date > SINCE, dropwhile(lambda p: p.date > UNTIL, posts)):
            #p2 = str()
            p2 += str(post.date)+ "\n"
            print( )
        writer =csv.writer(f, delimiter =',', quoting= csv.QUOTE_MINIMAL)
        writer.writerow(['Username','User ID','Number of Posts','Followers Count','Following Count','Bio','External URL','Verified','Profile Pic','Real or Fake','Posts_Dates'])
        writer.writerow([profile.username,profile.userid,profile.mediacount,profile.followers,profile.followees,profile.biography,profile.external_url,profile.is_verified,profile.get_profile_pic_url(),"  ", p2])
        
    
